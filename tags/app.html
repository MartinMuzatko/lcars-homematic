<app>
    <lcars-headline>
        MisaPum 9177
    </lcars-headline>
    <div style="margin-left: 2em">
        <div layout="row" style="height: 8em;">
            <div each={section in sections} style="margin-right: 1em;" >
                <random-numbers></random-numbers>
            </div>
        </div>
		<a onclick={setVolume} data-volume="1" href="#" class="button red">Volume 1</a>
		<a onclick={setVolume} data-volume="10" href="#" class="button red">Volume 10</a>
		<a onclick={setVolume} data-volume="20" href="#" class="button red">Volume 20</a>
		<a onclick={setVolume} data-volume="30" href="#" class="button red">Volume 30</a>
		<a onclick={setVolume} data-volume="40" href="#" class="button red">Volume 40</a>
		<a onclick={setVolume} data-volume="50" href="#" class="button red">Volume 50</a>
		<a onclick={setVolume} data-volume="60" href="#" class="button red">Volume 60</a>
		<a onclick={setVolume} data-volume="70" href="#" class="button red">Volume 70</a>
		<a onclick={setVolume} data-volume="100" href="#" class="button red">Volume 100</a>
		<a onclick={switchYamaha} data-state="ON" href="#" class="button orange">YAMAHA ON</a>
		<a onclick={switchYamaha} data-state="OFF" href="#" class="button orange">YAMAHA OFF</a>
		<a onclick={setYamahaSource} data-state="HDMI4" href="#" class="button blue">ChromeCast</a>
        <a onclick={setYamahaSource} data-state="AV1" href="#" class="button violet">Squeezy</a>

    </div>
    <script>
        import './random-numbers.html'
        import './lcars-headline.html'
		import request from 'browser-request'
		import annyang from 'annyang'
        this.sections = []
		this.restURL = 'http://192.168.255.4:8080/rest/'

		this.actions = {
			setYamahaSource : (value)=>{
				var api = `${this.restURL}items/Yamaha_Source`
				request.post({uri:api, body:value}, ()=>{})
			},
			switchYamaha : (value)=>{
				var api = `${this.restURL}items/CimeAmp_Power`
				request.post({uri:api, body:value}, ()=>{})
			},
			setVolume : (value)=>{
				this.speak(`Lautstärke ${value} wird eingestellt`, ()=>{
					var api = `${this.restURL}items/YamahaReceiverRXV773_Volume`
					request.post({uri:api, body:value}, ()=>{})
				})
			},
		}

		setYamahaSource(event) {
			this.actions.setYamahaSource(event.target.dataset.state)
		}

		switchYamaha(event) {
			this.actions.switchYamaha(event.target.dataset.state)
		}

		setVolume(event) {
			this.actions.setVolume(event.target.dataset.volume)

		}

		this.speak = (text, action) => {
			var speak = new SpeechSynthesisUtterance(text)
			speak.voice = speechSynthesis.getVoices()[6]
			speak.lang = 'de-DE'
			if (action) {
				speak.onend = ()=>{
					action()
				}
			}
			speechSynthesis.speak(speak)
		}

        this.on('mount', ()=>{
			var commands = {
				'computer lautstärke :volume' : (volume)=>{this.actions.setVolume(volume)},
				'ich liebe dich' : ()=>{this.speak('ich dich auch, pum')},
			}
			annyang.setLanguage('de-DE')
			annyang.addCommands(commands)
			annyang.debug(true)
			annyang.start({continuous: false})
            setTimeout(()=>{
                this.sections.push(1)
                this.update()
                setTimeout(()=>{
                    this.sections.push(1)
                    this.update()
                    setTimeout(()=>{
                        this.sections.push(1)
                        this.update()
                    }, 1000)
                }, 1000)
            }, 1000)
        })

    </script>
</app>
